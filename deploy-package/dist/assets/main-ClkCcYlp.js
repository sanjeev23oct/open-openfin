var D=Object.defineProperty;var R=(r,e,t)=>e in r?D(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>R(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class T{constructor(e="platform-container"){this.windows=new Map,this.nextZIndex=1e3,this.focusedWindowId=null;const t=document.getElementById(e);if(!t)throw new Error(`Container element #${e} not found`);this.container=t}createWindow(e){var i,a,c,l;console.log("[BrowserWindowManager] Creating window:",e.appId);const t=this.generateWindowId(),n=document.createElement("div");if(n.id=t,n.className="platform-window",n.style.cssText=`
      position: absolute;
      left: ${((i=e.position)==null?void 0:i.x)||100}px;
      top: ${((a=e.position)==null?void 0:a.y)||100}px;
      width: ${((c=e.size)==null?void 0:c.width)||800}px;
      height: ${((l=e.size)==null?void 0:l.height)||600}px;
      z-index: ${this.nextZIndex++};
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    `,e.frame!==!1){const d=this.createTitleBar(t,e.title);n.appendChild(d)}const s=document.createElement("iframe");s.src=e.url,s.style.cssText=`
      flex: 1;
      border: none;
      width: 100%;
      height: 100%;
    `,e.sandbox?s.sandbox.add(...e.sandbox):s.sandbox.add("allow-scripts","allow-same-origin","allow-forms","allow-popups"),n.appendChild(s),this.container.appendChild(n);const o={id:t,appId:e.appId,iframe:s,position:e.position||{x:100,y:100},size:e.size||{width:800,height:600},state:"normal",zIndex:this.nextZIndex-1,focus:()=>this.focusWindow(t),close:()=>this.destroyWindow(t)};return this.windows.set(t,o),this.setupWindowInteractions(t,n,e),this.focusWindow(t),o}createTitleBar(e,t){const n=document.createElement("div");n.className="window-titlebar",n.style.cssText=`
      height: 32px;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 8px;
      cursor: move;
      user-select: none;
    `;const s=document.createElement("span");s.textContent=t,s.style.cssText=`
      font-size: 13px;
      font-weight: 500;
      color: #333;
    `;const o=document.createElement("div");o.style.cssText=`
      display: flex;
      gap: 8px;
    `;const i=this.createControlButton("‚àí",()=>this.minimizeWindow(e));o.appendChild(i);const a=this.createControlButton("‚ñ°",()=>this.maximizeWindow(e));o.appendChild(a);const c=this.createControlButton("√ó",()=>this.destroyWindow(e));return c.style.color="#d32f2f",o.appendChild(c),n.appendChild(s),n.appendChild(o),n}createControlButton(e,t){const n=document.createElement("button");return n.textContent=e,n.style.cssText=`
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    `,n.addEventListener("mouseenter",()=>{n.style.background="#e0e0e0"}),n.addEventListener("mouseleave",()=>{n.style.background="transparent"}),n.addEventListener("click",s=>{s.stopPropagation(),t()}),n}setupWindowInteractions(e,t,n){const s=t.querySelector(".window-titlebar");if(!s)return;n.resizable!==!1&&this.addResizeHandles(e,t,n);let o=!1,i=0,a=0,c=0,l=0;s.addEventListener("mousedown",d=>{if(d.target.tagName==="BUTTON")return;o=!0,i=d.clientX,a=d.clientY;const p=this.windows.get(e);p&&(c=p.position.x,l=p.position.y),this.focusWindow(e),d.preventDefault()}),document.addEventListener("mousemove",d=>{if(!o)return;const p=d.clientX-i,g=d.clientY-a;this.moveWindow(e,{x:c+p,y:l+g})}),document.addEventListener("mouseup",()=>{o=!1}),t.addEventListener("mousedown",()=>{this.focusWindow(e)})}addResizeHandles(e,t,n){["n","ne","e","se","s","sw","w","nw"].forEach(o=>{const i=document.createElement("div");i.className=`resize-handle resize-${o}`,i.style.cssText=this.getResizeHandleStyle(o);let a=!1,c=0,l=0,d=0,p=0,g=0,b=0;i.addEventListener("mousedown",w=>{w.stopPropagation(),a=!0,c=w.clientX,l=w.clientY;const f=this.windows.get(e);f&&(d=f.size.width,p=f.size.height,g=f.position.x,b=f.position.y),this.focusWindow(e)}),document.addEventListener("mousemove",w=>{var A,E,L,z;if(!a)return;const f=w.clientX-c,W=w.clientY-l;if(!this.windows.get(e))return;let y=d,x=p,k=g,C=b;o.includes("e")&&(y=Math.max(((A=n.minSize)==null?void 0:A.width)||200,d+f)),o.includes("w")&&(y=Math.max(((E=n.minSize)==null?void 0:E.width)||200,d-f),k=g+(d-y)),o.includes("s")&&(x=Math.max(((L=n.minSize)==null?void 0:L.height)||150,p+W)),o.includes("n")&&(x=Math.max(((z=n.minSize)==null?void 0:z.height)||150,p-W),C=b+(p-x)),n.maxSize&&(n.maxSize.width&&(y=Math.min(y,n.maxSize.width)),n.maxSize.height&&(x=Math.min(x,n.maxSize.height))),this.resizeWindow(e,{width:y,height:x}),(k!==g||C!==b)&&this.moveWindow(e,{x:k,y:C})}),document.addEventListener("mouseup",()=>{a=!1}),t.appendChild(i)})}getResizeHandleStyle(e){const t=`
      position: absolute;
      z-index: 10;
    `,n={n:"ns-resize",ne:"nesw-resize",e:"ew-resize",se:"nwse-resize",s:"ns-resize",sw:"nesw-resize",w:"ew-resize",nw:"nwse-resize"};let s="";switch(e){case"n":s="top: 0; left: 8px; right: 8px; height: 4px;";break;case"ne":s="top: 0; right: 0; width: 8px; height: 8px;";break;case"e":s="right: 0; top: 8px; bottom: 8px; width: 4px;";break;case"se":s="bottom: 0; right: 0; width: 8px; height: 8px;";break;case"s":s="bottom: 0; left: 8px; right: 8px; height: 4px;";break;case"sw":s="bottom: 0; left: 0; width: 8px; height: 8px;";break;case"w":s="left: 0; top: 8px; bottom: 8px; width: 4px;";break;case"nw":s="top: 0; left: 0; width: 8px; height: 8px;";break}return`${t}${s}cursor: ${n[e]};`}destroyWindow(e){if(console.log("[BrowserWindowManager] Destroying window:",e),!this.windows.get(e))return;const n=document.getElementById(e);n&&n.remove(),this.windows.delete(e),this.focusedWindowId===e&&(this.focusedWindowId=null)}moveWindow(e,t){const n=this.windows.get(e);if(!n)return;n.position=t;const s=document.getElementById(e);s&&(s.style.left=`${t.x}px`,s.style.top=`${t.y}px`)}resizeWindow(e,t){const n=this.windows.get(e);if(!n)return;n.size=t;const s=document.getElementById(e);s&&(s.style.width=`${t.width}px`,s.style.height=`${t.height}px`)}minimizeWindow(e){console.log("[BrowserWindowManager] Minimizing window:",e);const t=this.windows.get(e);if(!t)return;t.state="minimized";const n=document.getElementById(e);n&&(n.style.display="none")}maximizeWindow(e){console.log("[BrowserWindowManager] Maximizing window:",e);const t=this.windows.get(e);if(!t)return;const n=document.getElementById(e);n&&(t.state==="maximized"?(t.state="normal",n.style.left=`${t.position.x}px`,n.style.top=`${t.position.y}px`,n.style.width=`${t.size.width}px`,n.style.height=`${t.size.height}px`):(t.state="maximized",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%"))}focusWindow(e){const t=this.windows.get(e);if(!t)return;t.zIndex=this.nextZIndex++;const n=document.getElementById(e);n&&(n.style.zIndex=t.zIndex.toString()),this.focusedWindowId=e}getWindow(e){return this.windows.get(e)}getAllWindows(){return Array.from(this.windows.values())}getFocusedWindow(){return this.focusedWindowId&&this.windows.get(this.focusedWindowId)||null}generateWindowId(){return`window-${Date.now()}-${Math.random().toString(36).substring(7)}`}}class I{constructor(e,t,n){h(this,"id");h(this,"type");h(this,"displayMetadata");h(this,"contextListeners",new Map);h(this,"currentContext",new Map);this.id=e,this.type=t,this.displayMetadata=n}async broadcast(e){this.currentContext.set(e.type,e);const t=this.contextListeners.get(e.type)||new Set,n=this.contextListeners.get("*")||new Set;for(const s of[...t,...n])try{await s(e)}catch(o){console.error("Context handler error:",o)}}async getCurrentContext(e){if(e)return this.currentContext.get(e)||null;const t=Array.from(this.currentContext.values());return t.length>0?t[t.length-1]:null}addContextListener(e,t){const n=e||"*";return this.contextListeners.has(n)||this.contextListeners.set(n,new Set),this.contextListeners.get(n).add(t),{unsubscribe:()=>{var s;(s=this.contextListeners.get(n))==null||s.delete(t)}}}}class j{constructor(e){h(this,"id");h(this,"type","private");h(this,"contextListeners",new Map);h(this,"currentContext",new Map);h(this,"disconnectHandlers",new Set);h(this,"isDisconnected",!1);this.id=e}async broadcast(e){this.currentContext.set(e.type,e);const t=this.contextListeners.get(e.type)||new Set,n=this.contextListeners.get("*")||new Set;for(const s of[...t,...n])try{await s(e)}catch(o){console.error("Context handler error:",o)}}async getCurrentContext(e){if(e)return this.currentContext.get(e)||null;const t=Array.from(this.currentContext.values());return t.length>0?t[t.length-1]:null}addContextListener(e,t){const n=e||"*";return this.contextListeners.has(n)||this.contextListeners.set(n,new Set),this.contextListeners.get(n).add(t),{unsubscribe:()=>{var s;(s=this.contextListeners.get(n))==null||s.delete(t)}}}onDisconnect(e){this.disconnectHandlers.add(e)}async disconnect(){if(!this.isDisconnected){this.isDisconnected=!0;for(const e of this.disconnectHandlers)try{e()}catch(t){console.error("Disconnect handler error:",t)}this.disconnectHandlers.clear()}}}class U{constructor(){h(this,"userChannels",new Map);h(this,"appChannels",new Map);h(this,"privateChannels",new Map);this.initializeUserChannels()}initializeUserChannels(){const e=[{id:"red",color:"#f44336",name:"Red"},{id:"blue",color:"#2196F3",name:"Blue"},{id:"green",color:"#4CAF50",name:"Green"},{id:"yellow",color:"#FFC107",name:"Yellow"},{id:"orange",color:"#FF9800",name:"Orange"},{id:"purple",color:"#9C27B0",name:"Purple"}];for(const t of e){const n=new I(t.id,"user",{name:t.name,color:t.color});this.userChannels.set(t.id,n)}}getUserChannels(){return Array.from(this.userChannels.values())}getUserChannel(e){return this.userChannels.get(e)||null}getOrCreateAppChannel(e){if(!this.appChannels.has(e)){const t=new I(e,"app");this.appChannels.set(e,t)}return this.appChannels.get(e)}createPrivateChannel(){const e=this.generatePrivateChannelId(),t=new j(e);return this.privateChannels.set(e,t),t}getPrivateChannel(e){return this.privateChannels.get(e)||null}generatePrivateChannelId(){return`private-${Date.now()}-${Math.random().toString(36).substring(7)}`}}class O{constructor(){h(this,"intentHandlers",new Map);h(this,"appMetadata",new Map)}registerIntentHandler(e){const{intent:t}=e;this.intentHandlers.has(t)||this.intentHandlers.set(t,[]),this.intentHandlers.get(t).push(e)}unregisterIntentHandler(e,t){const n=this.intentHandlers.get(t);if(n){const s=n.filter(o=>o.appId!==e);s.length>0?this.intentHandlers.set(t,s):this.intentHandlers.delete(t)}}registerAppMetadata(e){this.appMetadata.set(e.appId,e)}findIntentHandlers(e,t){return this.intentHandlers.get(e)||[]}async resolveIntent(e,t,n){const s=this.findIntentHandlers(e,t);if(s.length===0)throw new Error(`No handlers found for intent: ${e}`);let o;if(n){if(o=s.find(i=>i.appId===n.appId),!o)throw new Error(`Target app ${n.appId} does not handle intent ${e}`)}else s.length===1?o=s[0]:o=await this.showResolverUI(e,s);return await o.handler(t)}getAppIntents(e){const t=[];for(const[n,s]of this.intentHandlers.entries()){const o=s.map(i=>this.appMetadata.get(i.appId)||{appId:i.appId,name:i.appId});t.push({intent:n,apps:o})}return t}async showResolverUI(e,t){return console.log(`Multiple handlers for ${e}, using first handler`),t[0]}}class H{constructor(){h(this,"subscriptions",new Map);h(this,"subscriptionsByType",new Map);h(this,"subscriptionsByApp",new Map)}subscribe(e,t,n){const s=this.generateSubscriptionId(),o=t||"*",i={id:s,appId:e,contextType:o,handler:n};return this.subscriptions.set(s,i),this.subscriptionsByType.has(o)||this.subscriptionsByType.set(o,new Set),this.subscriptionsByType.get(o).add(s),this.subscriptionsByApp.has(e)||this.subscriptionsByApp.set(e,new Set),this.subscriptionsByApp.get(e).add(s),{unsubscribe:()=>{this.unsubscribe(s)}}}unsubscribe(e){var n,s;const t=this.subscriptions.get(e);t&&((n=this.subscriptionsByType.get(t.contextType))==null||n.delete(e),(s=this.subscriptionsByApp.get(t.appId))==null||s.delete(e),this.subscriptions.delete(e))}async routeContext(e,t){const n=this.subscriptionsByType.get(e.type)||new Set,s=this.subscriptionsByType.get("*")||new Set,o=new Set([...n,...s]);for(const i of o){const a=this.subscriptions.get(i);if(a&&!(t&&a.appId===t))try{await a.handler(e)}catch(c){console.error(`Context handler error for ${a.appId}:`,c)}}}unsubscribeApp(e){const t=this.subscriptionsByApp.get(e);if(t)for(const n of t)this.unsubscribe(n)}generateSubscriptionId(){return`sub-${Date.now()}-${Math.random().toString(36).substring(7)}`}}class F{constructor(e=100){this.messages=[],this.maxMessages=100,this.listeners=new Set,this.enabled=!1,this.maxMessages=e}enable(){this.enabled=!0,console.log("[FDC3Monitor] Enabled")}disable(){this.enabled=!1,console.log("[FDC3Monitor] Disabled")}isEnabled(){return this.enabled}logMessage(e){if(!this.enabled)return;const t={...e,id:`msg-${Date.now()}-${Math.random().toString(36).substring(7)}`,timestamp:Date.now()};this.messages.unshift(t),this.messages.length>this.maxMessages&&(this.messages=this.messages.slice(0,this.maxMessages)),this.notifyListeners()}getMessages(){return[...this.messages]}clearMessages(){this.messages=[],this.notifyListeners()}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){const e=this.getMessages();this.listeners.forEach(t=>{try{t(e)}catch(n){console.error("[FDC3Monitor] Error in listener:",n)}})}exportMessages(){return JSON.stringify(this.messages,null,2)}getStats(){const e={total:this.messages.length,sent:0,received:0,byType:{}};return this.messages.forEach(t=>{t.direction==="sent"&&e.sent++,t.direction==="received"&&e.received++,e.byType[t.type]=(e.byType[t.type]||0)+1}),e}}const m=new F;class N{constructor(){this.registeredApps=new Map,this.appChannels=new Map,this.trustedOrigins=new Set(["*"]),this.channelManager=new U,this.intentResolver=new O,this.contextRouter=new H,this.setupMessageListener()}setupMessageListener(){window.addEventListener("message",e=>{this.handleMessage(e)})}handleMessage(e){if(!e.data||typeof e.data!="object")return;const{type:t,payload:n,messageId:s,appId:o,context:i}=e.data;if(t){if(t==="fdc3.broadcast"&&i){const a=this.findAppIdByWindow(e.source);a&&(console.log("[PostMessageRouter] FDC3 broadcast from",a),m.logMessage({direction:"received",type:"broadcast",from:a,payload:i}),this.handleBroadcast(a,i),this.broadcastContextToApps(i,a));return}if(!o){console.warn("[PostMessageRouter] Invalid message structure");return}if(!this.registeredApps.has(o)){console.warn("[PostMessageRouter] Message from unregistered app:",o);return}console.log("[PostMessageRouter] Received message:",t,"from",o),this.routeMessage(t,n,s,o,e.source)}}findAppIdByWindow(e){for(const[t,n]of this.registeredApps.entries())if(n.contentWindow===e)return t;return null}broadcastContextToApps(e,t){for(const[n,s]of this.registeredApps.entries())n!==t&&s.contentWindow&&(s.contentWindow.postMessage({type:"fdc3.context",context:e},"*"),m.logMessage({direction:"sent",type:"context",to:n,payload:e}))}async routeMessage(e,t,n,s,o){try{let i;switch(e){case"broadcast":await this.handleBroadcast(s,t.context),i={success:!0};break;case"raiseIntent":i=await this.handleRaiseIntent(s,t.intent,t.context,t.app);break;case"addContextListener":i=await this.handleAddContextListener(s,t.contextType,t.listenerId);break;case"removeContextListener":await this.handleRemoveContextListener(s,t.listenerId),i={success:!0};break;case"joinUserChannel":await this.handleJoinUserChannel(s,t.channelId),i={success:!0};break;case"leaveCurrentChannel":await this.handleLeaveCurrentChannel(s),i={success:!0};break;case"getUserChannels":i=this.channelManager.getUserChannels();break;case"getChannel":i=this.channelManager.getUserChannel(t.channelId);break;case"getOrCreateChannel":i=this.channelManager.getOrCreateAppChannel(t.channelId);break;default:throw new Error(`Unknown message type: ${e}`)}this.sendResponse(o,n,i)}catch(i){console.error("[PostMessageRouter] Error handling message:",i),this.sendError(o,n,i instanceof Error?i.message:"Unknown error")}}async handleBroadcast(e,t){console.log("[PostMessageRouter] Broadcasting context from",e,":",t);const n=this.appChannels.get(e);if(n){const s=this.channelManager.getUserChannel(n);s&&await s.broadcast(t)}else await this.contextRouter.routeContext(t,e)}async handleRaiseIntent(e,t,n,s){return console.log("[PostMessageRouter] Raising intent:",t,"from",e),await this.intentResolver.resolveIntent(t,n,s)}async handleAddContextListener(e,t,n){return console.log("[PostMessageRouter] Adding context listener for",e,":",t),this.contextRouter.subscribe(e,t,async s=>{const o=this.registeredApps.get(e);o&&o.contentWindow&&o.contentWindow.postMessage({type:"context",payload:{listenerId:n,context:s}},"*")}),{success:!0}}async handleRemoveContextListener(e,t){console.log("[PostMessageRouter] Removing context listener:",t)}async handleJoinUserChannel(e,t){console.log("[PostMessageRouter] App",e,"joining channel:",t),this.appChannels.get(e)&&await this.handleLeaveCurrentChannel(e),this.appChannels.set(e,t);const s=this.channelManager.getUserChannel(t);s&&s.addContextListener(null,async o=>{const i=this.registeredApps.get(e);i&&i.contentWindow&&i.contentWindow.postMessage({type:"context",payload:{context:o}},"*")})}async handleLeaveCurrentChannel(e){console.log("[PostMessageRouter] App",e,"leaving channel"),this.appChannels.delete(e)}sendResponse(e,t,n){e.postMessage({type:"response",messageId:t,payload:n},"*")}sendError(e,t,n){e.postMessage({type:"response",messageId:t,error:n},"*")}registerApplication(e,t){console.log("[PostMessageRouter] Registering app:",e),this.registeredApps.set(e,t)}unregisterApplication(e){console.log("[PostMessageRouter] Unregistering app:",e),this.registeredApps.delete(e),this.appChannels.delete(e),this.contextRouter.unsubscribeApp(e)}sendToApplication(e,t){const n=this.registeredApps.get(e);if(!n||!n.contentWindow){console.warn("[PostMessageRouter] App not found:",e);return}n.contentWindow.postMessage(t,"*")}broadcast(e,t){for(const[n,s]of this.registeredApps.entries())n!==t&&s.contentWindow&&s.contentWindow.postMessage(e,"*")}getChannelManager(){return this.channelManager}getIntentResolver(){return this.intentResolver}getContextRouter(){return this.contextRouter}}class q{constructor(e){this.currentWorkspace=null,this.autoSaveInterval=null,this.storage=e}async saveWorkspace(e,t){console.log("[WebWorkspaceManager] Saving workspace:",e);const n={id:this.generateWorkspaceId(),name:e,config:t||this.captureCurrentState(),createdAt:new Date,updatedAt:new Date};return await this.storage.set(n.id,n,"workspaces"),this.currentWorkspace=n,n}async loadWorkspace(e){console.log("[WebWorkspaceManager] Loading workspace:",e);const t=await this.storage.get(e,"workspaces");if(!t)throw new Error(`Workspace not found: ${e}`);this.currentWorkspace=t}async getWorkspaces(){const e=await this.storage.keys("workspaces"),t=[];for(const n of e){const s=await this.storage.get(n,"workspaces");s&&t.push(s)}return t.sort((n,s)=>new Date(s.updatedAt).getTime()-new Date(n.updatedAt).getTime())}async deleteWorkspace(e){var t;console.log("[WebWorkspaceManager] Deleting workspace:",e),await this.storage.delete(e,"workspaces"),((t=this.currentWorkspace)==null?void 0:t.id)===e&&(this.currentWorkspace=null)}getCurrentWorkspace(){return this.currentWorkspace}captureCurrentState(){return{applications:[],layout:{type:"free"}}}async exportWorkspace(e){const t=await this.storage.get(e,"workspaces");if(!t)throw new Error(`Workspace not found: ${e}`);return JSON.stringify(t,null,2)}async importWorkspace(e){const t=JSON.parse(e);return t.id=this.generateWorkspaceId(),t.createdAt=new Date,t.updatedAt=new Date,await this.storage.set(t.id,t,"workspaces"),t}generateShareableURL(e){return`${window.location.origin+window.location.pathname}?workspace=${e}`}enableAutoSave(e=3e4){this.autoSaveInterval&&clearInterval(this.autoSaveInterval),this.autoSaveInterval=window.setInterval(async()=>{this.currentWorkspace&&(console.log("[WebWorkspaceManager] Auto-saving workspace"),await this.saveWorkspace(this.currentWorkspace.name))},e)}disableAutoSave(){this.autoSaveInterval&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}generateWorkspaceId(){return`workspace-${Date.now()}-${Math.random().toString(36).substring(7)}`}}class Y{constructor(e){this.config=null,this.initialized=!1,this.windowManager=null,this.messageRouter=null,this.workspaceManager=null,this.appDirectory=new Map,this.storage=e}async initialize(e){if(console.log("[WebPlatformCore] Initializing with config:",e),this.config=e,this.windowManager=new T,this.messageRouter=new N,this.workspaceManager=new q(this.storage),await this.loadApplicationDirectory(e.appDirectory),await this.loadSavedApps(),e.defaultWorkspace)try{await this.workspaceManager.loadWorkspace(e.defaultWorkspace)}catch(t){console.warn("[WebPlatformCore] Failed to load default workspace:",t)}this.initialized=!0,console.log("[WebPlatformCore] Initialized successfully")}async shutdown(){if(console.log("[WebPlatformCore] Shutting down..."),this.windowManager){const e=this.windowManager.getAllWindows();for(const t of e)t.close()}this.initialized=!1}isInitialized(){return this.initialized}async loadApplicationDirectory(e){try{console.log("[WebPlatformCore] Loading app directory from:",e);const n=await(await fetch(e)).json();if(Array.isArray(n.applications)){for(const s of n.applications)this.appDirectory.set(s.appId,s);console.log("[WebPlatformCore] Loaded",this.appDirectory.size,"applications")}}catch(t){console.error("[WebPlatformCore] Failed to load app directory:",t)}}async launchApplication(e,t){var a,c,l,d,p,g,b;if(!this.windowManager||!this.messageRouter)throw new Error("Platform not initialized");console.log("[WebPlatformCore] Launching application:",e);const n=this.appDirectory.get(e);if(!n)throw new Error(`Application not found: ${e}`);const s=new URL(n.url,window.location.origin);s.searchParams.set("platformOrigin",window.location.origin),s.searchParams.set("appId",e);const o={appId:e,url:s.toString(),title:n.title||n.name,position:(a=n.window)==null?void 0:a.defaultPosition,size:((c=n.window)==null?void 0:c.defaultSize)||{width:800,height:600},minSize:(l=n.window)==null?void 0:l.minSize,maxSize:(d=n.window)==null?void 0:d.maxSize,resizable:((p=n.window)==null?void 0:p.resizable)!==!1,movable:((g=n.window)==null?void 0:g.movable)!==!1,frame:((b=n.window)==null?void 0:b.frame)!==!1,sandbox:n.sandbox},i=this.windowManager.createWindow(o);return this.messageRouter.registerApplication(e,i.iframe),t&&setTimeout(()=>{var w;(w=this.messageRouter)==null||w.sendToApplication(e,{type:"broadcast",payload:{context:t},messageId:"init",timestamp:Date.now()})},1e3),{appId:e,instanceId:i.id}}async closeApplication(e){if(!this.windowManager||!this.messageRouter)throw new Error("Platform not initialized");console.log("[WebPlatformCore] Closing application:",e);const t=this.windowManager.getWindow(e);t&&(this.messageRouter.unregisterApplication(t.appId),this.windowManager.destroyWindow(e))}getRunningApplications(){return this.windowManager?this.windowManager.getAllWindows().map(e=>({appId:e.appId,instanceId:e.id,state:e.state})):[]}async broadcast(e,t){if(!this.messageRouter)throw new Error("Platform not initialized");console.log("[WebPlatformCore] Broadcasting context:",e)}async saveWorkspace(e){if(!this.workspaceManager)throw new Error("Platform not initialized");return await this.workspaceManager.saveWorkspace(e)}async loadWorkspace(e){if(!this.workspaceManager)throw new Error("Platform not initialized");await this.workspaceManager.loadWorkspace(e)}async getWorkspaces(){if(!this.workspaceManager)throw new Error("Platform not initialized");return await this.workspaceManager.getWorkspaces()}getApplicationDirectory(){return Array.from(this.appDirectory.values())}addExternalApp(e){const t=`external-${Date.now()}-${Math.random().toString(36).substring(7)}`,n={appId:t,name:e.name,title:e.name,description:e.description||"External web application",url:e.url,icon:e.icon||"üåê",window:{defaultSize:{width:1e3,height:700},minSize:{width:400,height:300}},external:!0};this.appDirectory.set(t,n),this.saveAppDirectory(),console.log("[WebPlatformCore] Added external app:",t,e.name)}removeApp(e){this.appDirectory.delete(e),this.saveAppDirectory(),console.log("[WebPlatformCore] Removed app:",e)}async saveAppDirectory(){try{const e=Array.from(this.appDirectory.values());await this.storage.set("appDirectory",e)}catch(e){console.error("[WebPlatformCore] Failed to save app directory:",e)}}async loadSavedApps(){try{const e=await this.storage.get("appDirectory");Array.isArray(e)&&(e.forEach(t=>{t.external&&this.appDirectory.set(t.appId,t)}),console.log("[WebPlatformCore] Loaded",e.length,"saved apps"))}catch(e){console.error("[WebPlatformCore] Failed to load saved apps:",e)}}getWindowManager(){return this.windowManager}getMessageRouter(){return this.messageRouter}getWorkspaceManager(){return this.workspaceManager}}class X{constructor(){this.db=null,this.dbName="openfin-web-platform",this.dbVersion=1,this.useLocalStorage=!1}async initialize(){try{this.db=await this.openIndexedDB(),console.log("[StorageManager] Using IndexedDB")}catch(e){console.warn("[StorageManager] IndexedDB unavailable, falling back to localStorage:",e),this.useLocalStorage=!0}}openIndexedDB(){return new Promise((e,t)=>{if(!("indexedDB"in window)){t(new Error("IndexedDB not supported"));return}const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=s=>{const o=s.target.result;o.objectStoreNames.contains("workspaces")||o.createObjectStore("workspaces",{keyPath:"id"}),o.objectStoreNames.contains("settings")||o.createObjectStore("settings")}})}async set(e,t,n="settings"){if(this.useLocalStorage){localStorage.setItem(`${n}:${e}`,JSON.stringify(t));return}if(!this.db)throw new Error("Storage not initialized");return new Promise((s,o)=>{const c=this.db.transaction([n],"readwrite").objectStore(n).put(t,e);c.onsuccess=()=>s(),c.onerror=()=>o(c.error)})}async get(e,t="settings"){if(this.useLocalStorage){const n=localStorage.getItem(`${t}:${e}`);return n?JSON.parse(n):null}if(!this.db)throw new Error("Storage not initialized");return new Promise((n,s)=>{const a=this.db.transaction([t],"readonly").objectStore(t).get(e);a.onsuccess=()=>n(a.result),a.onerror=()=>s(a.error)})}async delete(e,t="settings"){if(this.useLocalStorage){localStorage.removeItem(`${t}:${e}`);return}if(!this.db)throw new Error("Storage not initialized");return new Promise((n,s)=>{const a=this.db.transaction([t],"readwrite").objectStore(t).delete(e);a.onsuccess=()=>n(),a.onerror=()=>s(a.error)})}async keys(e="settings"){if(this.useLocalStorage){const t=`${e}:`;return Object.keys(localStorage).filter(n=>n.startsWith(t)).map(n=>n.substring(t.length))}if(!this.db)throw new Error("Storage not initialized");return new Promise((t,n)=>{const i=this.db.transaction([e],"readonly").objectStore(e).getAllKeys();i.onsuccess=()=>t(i.result),i.onerror=()=>n(i.error)})}async clear(e="settings"){if(this.useLocalStorage){const t=`${e}:`;Object.keys(localStorage).filter(s=>s.startsWith(t)).forEach(s=>localStorage.removeItem(s));return}if(!this.db)throw new Error("Storage not initialized");return new Promise((t,n)=>{const i=this.db.transaction([e],"readwrite").objectStore(e).clear();i.onsuccess=()=>t(),i.onerror=()=>n(i.error)})}async getUsage(){if("storage"in navigator&&"estimate"in navigator.storage){const e=await navigator.storage.estimate();return{used:e.usage||0,quota:e.quota||0,percentage:e.quota?(e.usage||0)/e.quota*100:0}}return{used:0,quota:5*1024*1024,percentage:0}}async exportAll(){const e={workspaces:{},settings:{}},t=await this.keys("workspaces");for(const s of t)e.workspaces[s]=await this.get(s,"workspaces");const n=await this.keys("settings");for(const s of n)e.settings[s]=await this.get(s,"settings");return JSON.stringify(e,null,2)}async importAll(e){const t=JSON.parse(e);if(t.workspaces)for(const[n,s]of Object.entries(t.workspaces))await this.set(n,s,"workspaces");if(t.settings)for(const[n,s]of Object.entries(t.settings))await this.set(n,s,"settings")}}function B(){return typeof window.fin<"u"?"desktop":window.parent!==window&&typeof window.fdc3<"u"?"web":"standalone"}function S(){const r=navigator.userAgent;return{hasDesktopAPI:typeof window.fin<"u",hasWebPlatform:window.parent!==window,hasFDC3:typeof window.fdc3<"u",hasServiceWorker:"serviceWorker"in navigator,hasIndexedDB:"indexedDB"in window,hasLocalStorage:typeof localStorage<"u",hasWebCrypto:"crypto"in window&&"subtle"in window.crypto,hasSharedWorker:typeof SharedWorker<"u",hasBroadcastChannel:typeof BroadcastChannel<"u",isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(r),isTablet:/iPad|Android/i.test(r)&&!/Mobile/i.test(r),browserName:K(),browserVersion:Z()}}function V(){const r=S(),e=[],t=["hasIndexedDB","hasLocalStorage"],n=["hasServiceWorker","hasWebCrypto","hasBroadcastChannel"];for(const s of t)r[s]||e.push(`${s} (required)`);for(const s of n)r[s]||e.push(`${s} (recommended)`);return e}function J(){const r=S();return r.hasIndexedDB&&r.hasLocalStorage}function P(){const r=B(),e=S(),t=V(),n=[];return e.isMobile&&n.push("Mobile browsers have limited window management capabilities"),e.hasServiceWorker||n.push("Offline support unavailable without Service Worker"),e.hasWebCrypto||n.push("Data encryption unavailable without Web Crypto API"),{supported:J(),platform:r,capabilities:e,missing:t,warnings:n}}function K(){const r=navigator.userAgent;return r.includes("Firefox")?"Firefox":r.includes("Edg")?"Edge":r.includes("Chrome")?"Chrome":r.includes("Safari")&&!r.includes("Chrome")?"Safari":r.includes("Opera")||r.includes("OPR")?"Opera":"Unknown"}function Z(){const r=navigator.userAgent;let e;return(e=r.match(/Firefox\/(\d+)/))||(e=r.match(/Edg\/(\d+)/))||(e=r.match(/Chrome\/(\d+)/))||(e=r.match(/Version\/(\d+).*Safari/))||(e=r.match(/Opera\/(\d+)/))||(e=r.match(/OPR\/(\d+)/))?e[1]:"Unknown"}function G(){const r=P();if(r.supported)r.warnings.length>0&&console.warn("[Platform] Compatibility warnings:",r.warnings);else{console.error("[Platform] Browser not supported!",r);const e=`
      Your browser is not supported.
      
      Missing capabilities:
      ${r.missing.join(`
`)}
      
      Please use a modern browser like Chrome, Firefox, or Edge.
    `;alert(e)}}class Q{constructor(){this.container=null,this.unsubscribe=null,this.isVisible=!1}show(){this.isVisible||(this.isVisible=!0,this.createUI(),m.enable(),this.unsubscribe=m.subscribe(e=>{this.updateMessages(e)}),this.updateMessages(m.getMessages()))}hide(){this.isVisible&&(this.isVisible=!1,this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.container&&(this.container.remove(),this.container=null))}toggle(){this.isVisible?this.hide():this.show()}createUI(){var e,t,n;this.container=document.createElement("div"),this.container.id="fdc3-monitor",this.container.style.cssText=`
      position: fixed;
      bottom: 0;
      right: 0;
      width: 400px;
      height: 300px;
      background: rgba(0, 0, 0, 0.95);
      border: 1px solid #333;
      border-radius: 8px 0 0 0;
      display: flex;
      flex-direction: column;
      z-index: 10000;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #fff;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.3);
    `,this.container.innerHTML=`
      <div style="padding: 8px 12px; background: #1a1a1a; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="color: #4ade80; font-weight: bold;">‚óè</span>
          <span style="font-weight: bold;">FDC3 Monitor</span>
          <span id="fdc3-monitor-count" style="color: #888; font-size: 11px;">(0)</span>
        </div>
        <div style="display: flex; gap: 8px;">
          <button id="fdc3-monitor-clear" style="background: #333; border: none; color: #fff; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">Clear</button>
          <button id="fdc3-monitor-export" style="background: #333; border: none; color: #fff; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">Export</button>
          <button id="fdc3-monitor-close" style="background: #333; border: none; color: #fff; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">‚úï</button>
        </div>
      </div>
      <div id="fdc3-monitor-messages" style="flex: 1; overflow-y: auto; padding: 8px;">
        <div style="color: #666; text-align: center; padding: 20px;">No messages yet...</div>
      </div>
      <div id="fdc3-monitor-stats" style="padding: 6px 12px; background: #1a1a1a; border-top: 1px solid #333; font-size: 10px; color: #888;">
        Sent: <span id="fdc3-stats-sent">0</span> | Received: <span id="fdc3-stats-received">0</span>
      </div>
    `,document.body.appendChild(this.container),(e=this.container.querySelector("#fdc3-monitor-clear"))==null||e.addEventListener("click",()=>{m.clearMessages()}),(t=this.container.querySelector("#fdc3-monitor-export"))==null||t.addEventListener("click",()=>{const s=m.exportMessages(),o=new Blob([s],{type:"application/json"}),i=URL.createObjectURL(o),a=document.createElement("a");a.href=i,a.download=`fdc3-messages-${Date.now()}.json`,a.click(),URL.revokeObjectURL(i)}),(n=this.container.querySelector("#fdc3-monitor-close"))==null||n.addEventListener("click",()=>{this.hide()}),this.makeDraggable()}updateMessages(e){if(!this.container)return;const t=this.container.querySelector("#fdc3-monitor-messages"),n=this.container.querySelector("#fdc3-monitor-count");if(!t||!n)return;if(n.textContent=`(${e.length})`,e.length===0){t.innerHTML='<div style="color: #666; text-align: center; padding: 20px;">No messages yet...</div>';return}t.innerHTML=e.map(a=>{const c=new Date(a.timestamp).toLocaleTimeString(),l=a.direction==="sent"?"#3b82f6":"#10b981",d=a.direction==="sent"?"‚Üë":"‚Üì";return`
        <div style="margin-bottom: 8px; padding: 6px; background: #1a1a1a; border-left: 3px solid ${l}; border-radius: 4px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span style="color: ${l}; font-weight: bold;">${d} ${a.type}</span>
            <span style="color: #666; font-size: 10px;">${c}</span>
          </div>
          ${a.from?`<div style="color: #888; font-size: 10px;">From: ${a.from}</div>`:""}
          ${a.to?`<div style="color: #888; font-size: 10px;">To: ${a.to}</div>`:""}
          ${a.channel?`<div style="color: #888; font-size: 10px;">Channel: ${a.channel}</div>`:""}
          <div style="color: #aaa; font-size: 11px; margin-top: 4px; max-height: 60px; overflow: auto;">
            ${JSON.stringify(a.payload,null,2)}
          </div>
        </div>
      `}).join("");const s=m.getStats(),o=this.container.querySelector("#fdc3-stats-sent"),i=this.container.querySelector("#fdc3-stats-received");o&&(o.textContent=s.sent.toString()),i&&(i.textContent=s.received.toString())}makeDraggable(){if(!this.container)return;const e=this.container.querySelector("div");if(!e)return;let t=!1,n=0,s=0,o=0,i=0;e.style.cursor="move",e.addEventListener("mousedown",a=>{if(a.target.tagName==="BUTTON")return;t=!0,n=a.clientX,s=a.clientY;const c=this.container.getBoundingClientRect();o=window.innerWidth-c.right,i=window.innerHeight-c.bottom}),document.addEventListener("mousemove",a=>{if(!t||!this.container)return;const c=n-a.clientX,l=a.clientY-s;this.container.style.right=`${o+c}px`,this.container.style.bottom=`${i-l}px`}),document.addEventListener("mouseup",()=>{t=!1})}}const _=new Q;let u,M;document.addEventListener("DOMContentLoaded",async()=>{console.log("[Web Platform] Initializing...");const r=P();if(console.log("[Web Platform] Compatibility Report:",r),!r.supported){G();return}const e=B();console.log("[Web Platform] Platform Type:",e);try{M=new X,await M.initialize(),u=new Y(M),await u.initialize({appDirectory:"/apps/directory.json",theme:"light",enableMultiTab:!1,performanceMode:!1}),window.platform=u,window.platformType=e,window.platformCapabilities=r.capabilities;const t=document.getElementById("loading");t&&(t.style.display="none"),ee(),await se(),console.log("[Web Platform] Ready!")}catch(t){console.error("[Web Platform] Initialization failed:",t);const n=document.getElementById("loading");n&&(n.innerHTML=`
        <div style="color: #d32f2f;">
          <h2>Platform Failed to Load</h2>
          <p>${t instanceof Error?t.message:"Unknown error"}</p>
        </div>
      `)}});function ee(){var r,e,t;$(),document.querySelectorAll(".channel-btn").forEach(n=>{n.addEventListener("click",async()=>{const s=n.getAttribute("data-channel");s&&(document.querySelectorAll(".channel-btn").forEach(o=>o.classList.remove("active")),n.classList.add("active"),console.log("Switched to channel:",s))})}),(r=document.getElementById("fdc3-monitor-toggle"))==null||r.addEventListener("click",()=>{_.toggle()}),(e=document.getElementById("save-workspace"))==null||e.addEventListener("click",async()=>{var s;const n=prompt("Enter workspace name:");if(n)try{await u.saveWorkspace(n),alert(`Workspace "${n}" saved!`)}catch(o){alert(`Failed to save workspace: ${o}`)}(s=document.getElementById("workspace-dropdown"))==null||s.classList.remove("visible")}),(t=document.getElementById("load-workspace"))==null||t.addEventListener("click",async()=>{var n;try{const s=await u.getWorkspaces();if(s.length===0){alert("No saved workspaces");return}const o=s.map((a,c)=>`${c+1}. ${a.name}`).join(`
`),i=prompt(`Select workspace:
${o}

Enter number:`);if(i){const a=parseInt(i)-1;a>=0&&a<s.length&&(await u.loadWorkspace(s[a].id),alert(`Loaded workspace "${s[a].name}"`))}}catch(s){alert(`Failed to load workspace: ${s}`)}(n=document.getElementById("workspace-dropdown"))==null||n.classList.remove("visible")}),setInterval(v,1e3)}function $(){var t;const r=u.getApplicationDirectory(),e=document.getElementById("app-grid");e&&(e.innerHTML=r.map(n=>`
      <div class="app-card" data-app-id="${n.appId}">
        <div class="app-icon">${n.icon||"üì±"}</div>
        <div class="app-name">${n.name}</div>
        <div class="app-description">${n.description||""}</div>
      </div>
    `).join("")+`
      <div class="app-card app-card-add" id="add-external-app-btn">
        <div class="app-icon">‚ûï</div>
        <div class="app-name">Add External App</div>
        <div class="app-description">Add custom web app</div>
      </div>
    `,e.querySelectorAll(".app-card:not(.app-card-add)").forEach(n=>{n.addEventListener("click",async()=>{var o;const s=n.getAttribute("data-app-id");s&&(await ne(s),(o=document.getElementById("app-launcher"))==null||o.classList.remove("visible"))})}),(t=document.getElementById("add-external-app-btn"))==null||t.addEventListener("click",()=>{te()}))}function te(){var e,t;const r=document.createElement("div");r.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3000;
  `,r.innerHTML=`
    <div style="background: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%;">
      <h2 style="margin: 0 0 20px 0; color: #333;">Add External App</h2>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 4px; color: #666; font-size: 14px;">App Name</label>
        <input type="text" id="ext-app-name" placeholder="My Custom App" 
               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 4px; color: #666; font-size: 14px;">App URL</label>
        <input type="url" id="ext-app-url" placeholder="https://example.com/app" 
               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
      </div>
      
      <div style="margin-bottom: 16px;">
        <label style="display: block; margin-bottom: 4px; color: #666; font-size: 14px;">Icon (emoji)</label>
        <input type="text" id="ext-app-icon" placeholder="üåê" maxlength="2"
               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 4px; color: #666; font-size: 14px;">Description (optional)</label>
        <input type="text" id="ext-app-desc" placeholder="A custom web application" 
               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
      </div>
      
      <div style="display: flex; gap: 12px; justify-content: flex-end;">
        <button id="cancel-add-app" style="padding: 8px 16px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer;">
          Cancel
        </button>
        <button id="confirm-add-app" style="padding: 8px 16px; border: none; background: #667eea; color: white; border-radius: 6px; cursor: pointer;">
          Add App
        </button>
      </div>
    </div>
  `,document.body.appendChild(r),setTimeout(()=>{var n;(n=document.getElementById("ext-app-name"))==null||n.focus()},100),(e=r.querySelector("#cancel-add-app"))==null||e.addEventListener("click",()=>{r.remove()}),(t=r.querySelector("#confirm-add-app"))==null||t.addEventListener("click",async()=>{var a,c,l,d;const n=(a=document.getElementById("ext-app-name"))==null?void 0:a.value,s=(c=document.getElementById("ext-app-url"))==null?void 0:c.value,o=((l=document.getElementById("ext-app-icon"))==null?void 0:l.value)||"üåê",i=(d=document.getElementById("ext-app-desc"))==null?void 0:d.value;if(!n||!s){alert("Please enter both name and URL");return}try{new URL(s),u.addExternalApp({name:n,url:s,icon:o,description:i}),$(),r.remove();const p=document.createElement("div");p.style.cssText=`
        position: fixed;
        top: 80px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 4000;
      `,p.textContent=`Added "${n}" to app directory`,document.body.appendChild(p),setTimeout(()=>p.remove(),3e3)}catch{alert("Invalid URL. Please enter a valid web address.")}}),r.addEventListener("click",n=>{n.target===r&&r.remove()})}async function ne(r){try{console.log("[UI] Launching app:",r),await u.launchApplication(r),v()}catch(e){console.error("[UI] Failed to launch app:",e),alert(`Failed to launch app: ${e}`)}}async function se(){try{console.log("[Web Platform] Auto-launching demo apps...");const r=20,e=10,t=80,n=100,s=window.innerWidth-2*r-e,o=Math.floor(s/2),i=window.innerHeight-t-n,a=await u.launchApplication("ticker-list",{bounds:{x:r,y:t,width:o,height:i}});await new Promise(l=>setTimeout(l,500));const c=await u.launchApplication("ticker-details",{bounds:{x:r+o+e,y:t,width:o,height:i}});console.log("[Web Platform] Demo apps launched:",{tickerListId:a,tickerDetailsId:c}),v()}catch(r){console.error("[Web Platform] Failed to auto-launch demo apps:",r)}}function v(){const r=u.getRunningApplications(),e=document.getElementById("platform-dock");if(!e)return;const t=u.getApplicationDirectory(),n=new Map(t.map(s=>[s.appId,s]));e.innerHTML=r.map(s=>{const o=n.get(s.appId),i=(o==null?void 0:o.icon)||"üì±";return`
      <div class="dock-app ${s.state==="normal"?"active":""}" data-instance-id="${s.instanceId}">
        <div class="dock-app-icon">${i}</div>
        <div class="dock-app-close">√ó</div>
      </div>
    `}).join(""),e.querySelectorAll(".dock-app").forEach(s=>{const o=s.getAttribute("data-instance-id");s.addEventListener("click",a=>{if(!a.target.classList.contains("dock-app-close")){const c=u.getWindowManager();if(c&&o){const l=c.getWindow(o);l&&(l.state==="minimized"&&c.maximizeWindow(o),l.focus())}}});const i=s.querySelector(".dock-app-close");i==null||i.addEventListener("click",async a=>{a.stopPropagation(),o&&(await u.closeApplication(o),v())})})}
//# sourceMappingURL=main-ClkCcYlp.js.map
