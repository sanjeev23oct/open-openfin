<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Watch - Ticker List</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0078d4',
            success: '#10b981',
            danger: '#ef4444',
          }
        }
      }
    }
  </script>
  <style>
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .ticker-row {
      animation: slideIn 0.3s ease-out;
    }
    .ticker-row:hover {
      transform: translateX(4px);
      transition: transform 0.2s;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white min-h-screen">
  <!-- Header -->
  <div class="bg-gray-800/50 backdrop-blur-sm border-b border-gray-700 sticky top-0 z-10">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
            </svg>
          </div>
          <div>
            <h1 class="text-xl font-bold">Market Watch</h1>
            <p class="text-xs text-gray-400">Real-time Stock Tickers</p>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2 bg-gray-700/50 px-3 py-2 rounded-lg">
            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            <span class="text-sm" id="channelStatus">Not Connected</span>
          </div>
          <button onclick="joinChannel()" class="bg-primary hover:bg-blue-600 px-4 py-2 rounded-lg text-sm font-medium transition">
            Join Channel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Instructions Banner -->
  <div class="bg-blue-900/30 border-l-4 border-blue-500 p-4 m-6 rounded-r-lg">
    <div class="flex items-start">
      <svg class="w-6 h-6 text-blue-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div>
        <h3 class="font-semibold text-blue-300 mb-1">How to use:</h3>
        <ol class="text-sm text-gray-300 space-y-1">
          <li>1. Click <strong>"Join Channel"</strong> to connect to the FDC3 channel</li>
          <li>2. Click any ticker to broadcast its context to other apps</li>
          <li>3. Open "Ticker Details" app to see detailed information</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="container mx-auto px-6 py-4">
    <div class="relative">
      <input 
        type="text" 
        id="searchInput"
        placeholder="Search tickers..." 
        class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 pl-12 focus:outline-none focus:border-blue-500 transition"
        onkeyup="filterTickers()"
      >
      <svg class="w-5 h-5 text-gray-400 absolute left-4 top-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
    </div>
  </div>

  <!-- Ticker List -->
  <div class="container mx-auto px-6 pb-6">
    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 overflow-hidden">
      <!-- Table Header -->
      <div class="grid grid-cols-12 gap-4 px-6 py-4 bg-gray-700/50 text-sm font-semibold text-gray-300 border-b border-gray-700">
        <div class="col-span-3">Symbol</div>
        <div class="col-span-4">Company</div>
        <div class="col-span-2 text-right">Price</div>
        <div class="col-span-2 text-right">Change</div>
        <div class="col-span-1 text-right">Action</div>
      </div>
      
      <!-- Table Body -->
      <div id="tickerList" class="divide-y divide-gray-700">
        <!-- Tickers will be inserted here -->
      </div>
    </div>
  </div>

  <script>
    const tickers = [
      { symbol: 'AAPL', name: 'Apple Inc.', price: 178.72, change: 2.34, changePercent: 1.33 },
      { symbol: 'MSFT', name: 'Microsoft Corporation', price: 378.91, change: -1.23, changePercent: -0.32 },
      { symbol: 'GOOGL', name: 'Alphabet Inc.', price: 141.80, change: 3.45, changePercent: 2.49 },
      { symbol: 'AMZN', name: 'Amazon.com Inc.', price: 145.32, change: 1.87, changePercent: 1.30 },
      { symbol: 'TSLA', name: 'Tesla Inc.', price: 242.84, change: -5.67, changePercent: -2.28 },
      { symbol: 'META', name: 'Meta Platforms Inc.', price: 312.54, change: 4.23, changePercent: 1.37 },
      { symbol: 'NVDA', name: 'NVIDIA Corporation', price: 495.22, change: 12.45, changePercent: 2.58 },
      { symbol: 'JPM', name: 'JPMorgan Chase & Co.', price: 156.78, change: -0.89, changePercent: -0.56 },
      { symbol: 'V', name: 'Visa Inc.', price: 245.67, change: 2.11, changePercent: 0.87 },
      { symbol: 'WMT', name: 'Walmart Inc.', price: 163.42, change: 1.23, changePercent: 0.76 },
      { symbol: 'DIS', name: 'The Walt Disney Company', price: 91.28, change: -1.45, changePercent: -1.56 },
      { symbol: 'NFLX', name: 'Netflix Inc.', price: 445.73, change: 8.92, changePercent: 2.04 },
    ];

    let currentChannel = null;

    function renderTickers() {
      const listEl = document.getElementById('tickerList');
      listEl.innerHTML = tickers.map(ticker => {
        const isPositive = ticker.change >= 0;
        const changeColor = isPositive ? 'text-success' : 'text-danger';
        const bgColor = isPositive ? 'bg-success/10' : 'bg-danger/10';
        
        return `
          <div class="ticker-row grid grid-cols-12 gap-4 px-6 py-4 hover:bg-gray-700/30 cursor-pointer transition" 
               onclick="selectTicker('${ticker.symbol}')"
               data-symbol="${ticker.symbol}"
               data-name="${ticker.name}">
            <div class="col-span-3 flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center font-bold text-sm">
                ${ticker.symbol.substring(0, 2)}
              </div>
              <span class="font-semibold">${ticker.symbol}</span>
            </div>
            <div class="col-span-4 flex items-center text-gray-300 text-sm">
              ${ticker.name}
            </div>
            <div class="col-span-2 flex items-center justify-end font-semibold">
              $${ticker.price.toFixed(2)}
            </div>
            <div class="col-span-2 flex items-center justify-end">
              <span class="${bgColor} ${changeColor} px-3 py-1 rounded-lg text-sm font-medium">
                ${isPositive ? '+' : ''}${ticker.change.toFixed(2)} (${isPositive ? '+' : ''}${ticker.changePercent.toFixed(2)}%)
              </span>
            </div>
            <div class="col-span-1 flex items-center justify-end">
              <button class="text-blue-400 hover:text-blue-300 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    async function joinChannel() {
      try {
        await window.fdc3.joinUserChannel('red');
        currentChannel = 'red';
        document.getElementById('channelStatus').textContent = 'Connected to Red Channel';
        showNotification('Connected to Red Channel', 'success');
      } catch (error) {
        console.error('Failed to join channel:', error);
        showNotification('Failed to join channel', 'error');
      }
    }

    async function selectTicker(symbol) {
      const ticker = tickers.find(t => t.symbol === symbol);
      if (!ticker) return;

      // Highlight selected ticker
      document.querySelectorAll('.ticker-row').forEach(row => {
        row.classList.remove('bg-blue-900/20', 'border-l-4', 'border-blue-500');
      });
      event.currentTarget.classList.add('bg-blue-900/20', 'border-l-4', 'border-blue-500');

      // Broadcast context
      const context = {
        type: 'fdc3.instrument',
        name: ticker.name,
        id: {
          ticker: ticker.symbol
        },
        price: ticker.price,
        change: ticker.change,
        changePercent: ticker.changePercent
      };

      try {
        await window.fdc3.broadcast(context);
        showNotification(`Broadcasting ${symbol} to other apps`, 'success');
      } catch (error) {
        console.error('Failed to broadcast:', error);
        showNotification('Please join a channel first', 'error');
      }
    }

    function filterTickers() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      document.querySelectorAll('.ticker-row').forEach(row => {
        const symbol = row.dataset.symbol.toLowerCase();
        const name = row.dataset.name.toLowerCase();
        if (symbol.includes(search) || name.includes(search)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    function showNotification(message, type) {
      const notification = document.createElement('div');
      const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
      notification.className = `fixed top-20 right-6 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slideIn`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    // Initialize
    renderTickers();

    // Simulate price updates
    setInterval(() => {
      tickers.forEach(ticker => {
        const change = (Math.random() - 0.5) * 2;
        ticker.price += change;
        ticker.change += change;
        ticker.changePercent = (ticker.change / (ticker.price - ticker.change)) * 100;
      });
      renderTickers();
    }, 5000);
  </script>
</body>
</html>
