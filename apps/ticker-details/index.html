<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ticker Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white min-h-screen">
  <!-- Header -->
  <div class="bg-gray-800/50 backdrop-blur-sm border-b border-gray-700">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-xl font-bold">Ticker Details</h1>
            <p class="text-xs text-gray-400">Comprehensive Stock Analysis</p>
          </div>
        </div>
        <div class="flex items-center space-x-2 bg-gray-700/50 px-3 py-2 rounded-lg">
          <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          <span class="text-sm" id="channelStatus">Listening on Red Channel</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Instructions Banner -->
  <div class="bg-purple-900/30 border-l-4 border-purple-500 p-4 m-6 rounded-r-lg">
    <div class="flex items-start">
      <svg class="w-6 h-6 text-purple-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div>
        <h3 class="font-semibold text-purple-300 mb-1">Listening for ticker updates:</h3>
        <p class="text-sm text-gray-300">This app automatically listens to the Red FDC3 channel. Click any ticker in the Market Watch app to see detailed information here.</p>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div id="emptyState" class="container mx-auto px-6 py-12 text-center">
    <div class="max-w-md mx-auto">
      <div class="w-24 h-24 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-12 h-12 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
      </div>
      <h2 class="text-2xl font-bold mb-2">No Ticker Selected</h2>
      <p class="text-gray-400">Select a ticker from the Market Watch app to view detailed information</p>
    </div>
  </div>

  <div id="detailsContent" class="container mx-auto px-6 pb-6 hidden">
    <!-- Stock Header -->
    <div class="bg-gradient-to-r from-purple-900/50 to-pink-900/50 backdrop-blur-sm rounded-xl border border-purple-700/50 p-6 mb-6 fade-in">
      <div class="flex items-start justify-between">
        <div>
          <div class="flex items-center space-x-3 mb-2">
            <h2 class="text-3xl font-bold" id="tickerSymbol">AAPL</h2>
            <span id="tickerBadge" class="bg-green-500/20 text-green-400 px-3 py-1 rounded-lg text-sm font-medium">
              +2.34%
            </span>
          </div>
          <p class="text-gray-300 text-lg" id="tickerName">Apple Inc.</p>
        </div>
        <div class="text-right">
          <div class="text-4xl font-bold" id="tickerPrice">$178.72</div>
          <div id="tickerChange" class="text-green-400 text-lg">+$2.34 (1.33%)</div>
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 p-4">
        <div class="text-gray-400 text-sm mb-1">Market Cap</div>
        <div class="text-2xl font-bold">$2.8T</div>
      </div>
      <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 p-4">
        <div class="text-gray-400 text-sm mb-1">Volume</div>
        <div class="text-2xl font-bold">52.3M</div>
      </div>
      <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 p-4">
        <div class="text-gray-400 text-sm mb-1">P/E Ratio</div>
        <div class="text-2xl font-bold">29.8</div>
      </div>
      <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 p-4">
        <div class="text-gray-400 text-sm mb-1">52W High</div>
        <div class="text-2xl font-bold">$199.62</div>
      </div>
    </div>

    <!-- Chart -->
    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 p-6 mb-6">
      <h3 class="text-lg font-semibold mb-4">Price Chart (1 Day)</h3>
      <canvas id="priceChart" height="80"></canvas>
    </div>

    <!-- Additional Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 p-6">
        <h3 class="text-lg font-semibold mb-4">Key Statistics</h3>
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-gray-400">Open</span>
            <span class="font-semibold">$176.38</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Previous Close</span>
            <span class="font-semibold">$176.38</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Day Range</span>
            <span class="font-semibold">$175.50 - $179.20</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">52 Week Range</span>
            <span class="font-semibold">$164.08 - $199.62</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Avg Volume</span>
            <span class="font-semibold">58.2M</span>
          </div>
        </div>
      </div>

      <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl border border-gray-700 p-6">
        <h3 class="text-lg font-semibold mb-4">Company Info</h3>
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-gray-400">Sector</span>
            <span class="font-semibold">Technology</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Industry</span>
            <span class="font-semibold">Consumer Electronics</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Employees</span>
            <span class="font-semibold">161,000</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Founded</span>
            <span class="font-semibold">1976</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-400">Headquarters</span>
            <span class="font-semibold">Cupertino, CA</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let chart = null;

    async function initializeChannel() {
      try {
        await window.fdc3.joinUserChannel('red');
        
        window.fdc3.addContextListener(null, (context) => {
          if (context.type === 'fdc3.instrument') {
            displayTickerDetails(context);
          }
        });
      } catch (error) {
        console.error('Failed to join channel:', error);
      }
    }

    function displayTickerDetails(context) {
      document.getElementById('emptyState').classList.add('hidden');
      document.getElementById('detailsContent').classList.remove('hidden');

      const isPositive = context.change >= 0;
      const changeColor = isPositive ? 'text-green-400' : 'text-red-400';
      const badgeColor = isPositive ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400';

      document.getElementById('tickerSymbol').textContent = context.id.ticker;
      document.getElementById('tickerName').textContent = context.name;
      document.getElementById('tickerPrice').textContent = `$${context.price.toFixed(2)}`;
      document.getElementById('tickerChange').textContent = `${isPositive ? '+' : ''}$${context.change.toFixed(2)} (${isPositive ? '+' : ''}${context.changePercent.toFixed(2)}%)`;
      document.getElementById('tickerChange').className = changeColor + ' text-lg';
      document.getElementById('tickerBadge').textContent = `${isPositive ? '+' : ''}${context.changePercent.toFixed(2)}%`;
      document.getElementById('tickerBadge').className = `${badgeColor} px-3 py-1 rounded-lg text-sm font-medium`;

      updateChart(context);
    }

    function updateChart(context) {
      const ctx = document.getElementById('priceChart').getContext('2d');
      
      // Generate sample data
      const labels = [];
      const data = [];
      const basePrice = context.price - context.change;
      
      for (let i = 0; i < 50; i++) {
        labels.push('');
        const variation = (Math.random() - 0.5) * 5;
        data.push(basePrice + (context.change / 50) * i + variation);
      }

      if (chart) {
        chart.destroy();
      }

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Price',
            data: data,
            borderColor: context.change >= 0 ? '#10b981' : '#ef4444',
            backgroundColor: context.change >= 0 ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 0,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: '#9ca3af'
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                display: false
              }
            }
          }
        }
      });
    }

    // Initialize
    initializeChannel();
  </script>
</body>
</html>
