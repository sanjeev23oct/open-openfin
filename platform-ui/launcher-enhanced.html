<!DOCTYPE html>
<html>
<head>
  <title>Desktop Interop Platform - Launcher</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
      font-weight: bold;
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .header-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      font-weight: 500;
    }
    
    .btn-primary {
      background: #4CAF50;
      color: white;
    }
    
    .btn-primary:hover {
      background: #45a049;
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .tabs {
      background: rgba(0, 0, 0, 0.2);
      padding: 0 20px;
      display: flex;
      gap: 5px;
    }
    
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }
    
    .tab:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .tab.active {
      border-bottom-color: #4CAF50;
      background: rgba(255, 255, 255, 0.1);
    }
    
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .section {
      margin-bottom: 30px;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .section-title {
      font-size: 18px;
      opacity: 0.9;
    }
    
    .app-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .app-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
      backdrop-filter: blur(10px);
    }
    
    .app-card:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    
    .app-card.running {
      border-color: #4CAF50;
    }
    
    .app-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 10px;
    }
    
    .app-name {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .app-description {
      font-size: 12px;
      opacity: 0.7;
      line-height: 1.4;
    }
    
    .app-status {
      margin-top: 10px;
      font-size: 11px;
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
      display: inline-block;
    }
    
    .app-status.running {
      background: rgba(76, 175, 80, 0.3);
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: #2a3f5f;
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: bold;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }
    
    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .form-input {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 14px;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #4CAF50;
      background: rgba(255, 255, 255, 0.15);
    }
    
    .form-hint {
      font-size: 12px;
      opacity: 0.7;
      margin-top: 5px;
    }
    
    .workspace-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
      border: 2px solid transparent;
      transition: all 0.3s;
    }
    
    .workspace-card:hover {
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    .workspace-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .workspace-name {
      font-size: 18px;
      font-weight: 600;
    }
    
    .workspace-apps {
      font-size: 14px;
      opacity: 0.7;
      margin-bottom: 15px;
    }
    
    .workspace-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    .btn-danger {
      background: #f44336;
      color: white;
    }
    
    .btn-danger:hover {
      background: #d32f2f;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      opacity: 0.5;
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">
      <div class="logo-icon">üöÄ</div>
      <span>Desktop Interop Platform</span>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="showAddAppModal()">
        ‚ûï Add App
      </button>
      <button class="btn btn-primary" onclick="showCreateWorkspaceModal()">
        üìÅ New Workspace
      </button>
    </div>
  </div>
  
  <div class="tabs">
    <div class="tab active" onclick="switchTab('apps')">üì± Applications</div>
    <div class="tab" onclick="switchTab('workspaces')">üìÅ Workspaces</div>
    <div class="tab" onclick="switchTab('running')">‚ñ∂Ô∏è Running</div>
  </div>
  
  <div class="main-content">
    <!-- Applications Tab -->
    <div id="apps-tab" class="tab-content active">
      <div class="section">
        <div class="section-header">
          <div class="section-title">Available Applications</div>
        </div>
        <div class="app-grid" id="app-directory"></div>
      </div>
    </div>
    
    <!-- Workspaces Tab -->
    <div id="workspaces-tab" class="tab-content">
      <div class="section">
        <div class="section-header">
          <div class="section-title">My Workspaces</div>
        </div>
        <div id="workspaces-list"></div>
      </div>
    </div>
    
    <!-- Running Apps Tab -->
    <div id="running-tab" class="tab-content">
      <div class="section">
        <div class="section-header">
          <div class="section-title">Running Applications</div>
        </div>
        <div id="running-apps"></div>
      </div>
    </div>
  </div>

  <!-- Add App Modal -->
  <div id="add-app-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Add External Application</div>
        <button class="modal-close" onclick="closeModal('add-app-modal')">√ó</button>
      </div>
      
      <form onsubmit="addExternalApp(event)">
        <div class="form-group">
          <label class="form-label">Application Name *</label>
          <input type="text" class="form-input" id="app-name" placeholder="e.g., Gmail" required>
          <div class="form-hint">Display name for the application</div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Application URL *</label>
          <input type="url" class="form-input" id="app-url" placeholder="https://mail.google.com" required>
          <div class="form-hint">Full URL including https://</div>
        </div>
        
        <div class="form-group">
          <label class="form-label">App ID *</label>
          <input type="text" class="form-input" id="app-id" placeholder="com.google.gmail" required>
          <div class="form-hint">Unique identifier (reverse domain notation)</div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Icon (Emoji)</label>
          <input type="text" class="form-input" id="app-icon" placeholder="üìß" maxlength="2">
          <div class="form-hint">Single emoji character</div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Description</label>
          <input type="text" class="form-input" id="app-description" placeholder="Google Mail in a container">
        </div>
        
        <div class="form-group">
          <label class="form-label">Window Width</label>
          <input type="number" class="form-input" id="app-width" value="1200" min="400">
        </div>
        
        <div class="form-group">
          <label class="form-label">Window Height</label>
          <input type="number" class="form-input" id="app-height" value="800" min="300">
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button type="button" class="btn btn-secondary" onclick="closeModal('add-app-modal')">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            Add Application
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Workspace Modal -->
  <div id="create-workspace-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Create Workspace</div>
        <button class="modal-close" onclick="closeModal('create-workspace-modal')">√ó</button>
      </div>
      
      <form onsubmit="createWorkspace(event)">
        <div class="form-group">
          <label class="form-label">Workspace Name *</label>
          <input type="text" class="form-input" id="workspace-name" placeholder="My Trading Workspace" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Description</label>
          <input type="text" class="form-input" id="workspace-description" placeholder="Workspace for trading applications">
        </div>
        
        <div class="form-group">
          <label class="form-label">Select Applications</label>
          <div id="workspace-app-selection" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button type="button" class="btn btn-secondary" onclick="closeModal('create-workspace-modal')">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">
            Create Workspace
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Application directory (loaded from localStorage + defaults)
    let apps = [];
    let workspaces = [];
    const runningApps = new Map();
    
    // Initialize
    function init() {
      loadApps();
      loadWorkspaces();
      renderApps();
      renderWorkspaces();
      renderRunningApps();
    }
    
    // Load apps from localStorage
    function loadApps() {
      const defaultApps = [
        {
          id: 'sample-app-1',
          name: 'Broadcaster',
          description: 'Broadcast FDC3 instrument contexts',
          icon: 'üì°',
          manifest: 'apps/sample-app-1/manifest.json'
        },
        {
          id: 'sample-app-2',
          name: 'Listener',
          description: 'Listen for FDC3 contexts',
          icon: 'üìª',
          manifest: 'apps/sample-app-2/manifest.json'
        },
        {
          id: 'com.google.gmail',
          name: 'Gmail',
          description: 'Google Mail in a container',
          icon: 'üìß',
          manifest: 'apps/gmail/manifest.json'
        },
        {
          id: 'com.google.search',
          name: 'Google',
          description: 'Google Search in a container',
          icon: 'üîç',
          manifest: 'apps/google/manifest.json'
        }
      ];
      
      const savedApps = localStorage.getItem('platform-apps');
      apps = savedApps ? JSON.parse(savedApps) : defaultApps;
    }
    
    // Save apps to localStorage
    function saveApps() {
      localStorage.setItem('platform-apps', JSON.stringify(apps));
    }
    
    // Load workspaces
    function loadWorkspaces() {
      const saved = localStorage.getItem('platform-workspaces');
      workspaces = saved ? JSON.parse(saved) : [];
    }
    
    // Save workspaces
    function saveWorkspaces() {
      localStorage.setItem('platform-workspaces', JSON.stringify(workspaces));
    }
    
    // Render apps
    function renderApps() {
      const grid = document.getElementById('app-directory');
      grid.innerHTML = '';
      
      apps.forEach(app => {
        const card = document.createElement('div');
        card.className = 'app-card';
        if (runningApps.has(app.id)) {
          card.classList.add('running');
        }
        
        card.innerHTML = `
          <div class="app-icon">${app.icon || 'üì¶'}</div>
          <div class="app-name">${app.name}</div>
          <div class="app-description">${app.description || ''}</div>
          <div class="app-status ${runningApps.has(app.id) ? 'running' : ''}">
            ${runningApps.has(app.id) ? '‚óè Running' : 'Click to launch'}
          </div>
        `;
        
        card.onclick = () => launchApp(app);
        grid.appendChild(card);
      });
    }
    
    // Render workspaces
    function renderWorkspaces() {
      const list = document.getElementById('workspaces-list');
      
      if (workspaces.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìÅ</div>
            <div>No workspaces yet</div>
            <div style="margin-top: 10px;">
              <button class="btn btn-primary" onclick="showCreateWorkspaceModal()">
                Create Your First Workspace
              </button>
            </div>
          </div>
        `;
        return;
      }
      
      list.innerHTML = '';
      workspaces.forEach((workspace, index) => {
        const card = document.createElement('div');
        card.className = 'workspace-card';
        card.innerHTML = `
          <div class="workspace-header">
            <div class="workspace-name">${workspace.name}</div>
          </div>
          <div class="workspace-apps">
            ${workspace.apps.length} application(s): ${workspace.apps.map(a => a.name).join(', ')}
          </div>
          <div class="workspace-actions">
            <button class="btn btn-primary btn-small" onclick="launchWorkspace(${index})">
              Launch Workspace
            </button>
            <button class="btn btn-danger btn-small" onclick="deleteWorkspace(${index})">
              Delete
            </button>
          </div>
        `;
        list.appendChild(card);
      });
    }
    
    // Render running apps
    function renderRunningApps() {
      const container = document.getElementById('running-apps');
      
      if (runningApps.size === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üí§</div>
            <div>No applications running</div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = '';
      runningApps.forEach((app, id) => {
        const card = document.createElement('div');
        card.className = 'workspace-card';
        card.innerHTML = `
          <div class="workspace-header">
            <div style="display: flex; align-items: center; gap: 10px;">
              <span style="font-size: 24px;">${app.icon || 'üì¶'}</span>
              <div class="workspace-name">${app.name}</div>
            </div>
            <div class="workspace-actions">
              <button class="btn btn-secondary btn-small" onclick="focusApp('${id}')">
                Focus
              </button>
              <button class="btn btn-danger btn-small" onclick="closeApp('${id}')">
                Close
              </button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }
    
    // Switch tabs
    function switchTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById(`${tabName}-tab`).classList.add('active');
    }
    
    // Show modal
    function showModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }
    
    // Close modal
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }
    
    // Show add app modal
    function showAddAppModal() {
      showModal('add-app-modal');
    }
    
    // Add external app
    function addExternalApp(event) {
      event.preventDefault();
      
      const name = document.getElementById('app-name').value;
      const url = document.getElementById('app-url').value;
      const id = document.getElementById('app-id').value;
      const icon = document.getElementById('app-icon').value || 'üì¶';
      const description = document.getElementById('app-description').value;
      const width = parseInt(document.getElementById('app-width').value);
      const height = parseInt(document.getElementById('app-height').value);
      
      // Create manifest
      const manifest = {
        startup_app: {
          uuid: id,
          name: name,
          url: url,
          autoShow: true,
          frame: true,
          defaultWidth: width,
          defaultHeight: height,
          resizable: true,
          maximizable: true,
          minimizable: true
        },
        runtime: {
          version: "0.1.0"
        },
        permissions: {
          System: {
            clipboard: true,
            notifications: true
          },
          Network: {
            domains: [new URL(url).origin + "/*"]
          }
        }
      };
      
      // Add to apps
      const app = {
        id: id,
        name: name,
        description: description,
        icon: icon,
        manifest: manifest,
        isExternal: true
      };
      
      apps.push(app);
      saveApps();
      renderApps();
      
      closeModal('add-app-modal');
      event.target.reset();
      
      alert(`‚úÖ ${name} added successfully!`);
    }
    
    // Show create workspace modal
    function showCreateWorkspaceModal() {
      // Populate app selection
      const container = document.getElementById('workspace-app-selection');
      container.innerHTML = '';
      
      apps.forEach(app => {
        const checkbox = document.createElement('div');
        checkbox.style.cssText = 'padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; margin-bottom: 8px;';
        checkbox.innerHTML = `
          <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
            <input type="checkbox" value="${app.id}" style="width: 18px; height: 18px;">
            <span style="font-size: 20px;">${app.icon || 'üì¶'}</span>
            <span>${app.name}</span>
          </label>
        `;
        container.appendChild(checkbox);
      });
      
      showModal('create-workspace-modal');
    }
    
    // Create workspace
    function createWorkspace(event) {
      event.preventDefault();
      
      const name = document.getElementById('workspace-name').value;
      const description = document.getElementById('workspace-description').value;
      
      // Get selected apps
      const checkboxes = document.querySelectorAll('#workspace-app-selection input[type="checkbox"]:checked');
      const selectedApps = Array.from(checkboxes).map(cb => {
        return apps.find(app => app.id === cb.value);
      });
      
      if (selectedApps.length === 0) {
        alert('Please select at least one application');
        return;
      }
      
      const workspace = {
        id: `workspace-${Date.now()}`,
        name: name,
        description: description,
        apps: selectedApps,
        createdAt: new Date().toISOString()
      };
      
      workspaces.push(workspace);
      saveWorkspaces();
      renderWorkspaces();
      
      closeModal('create-workspace-modal');
      event.target.reset();
      
      alert(`‚úÖ Workspace "${name}" created successfully!`);
    }
    
    // Launch workspace with smart positioning
    async function launchWorkspace(index) {
      const workspace = workspaces[index];
      const appCount = workspace.apps.length;
      
      // Calculate layout based on number of apps
      const layout = calculateLayout(appCount);
      
      // Launch apps with calculated positions
      for (let i = 0; i < workspace.apps.length; i++) {
        const app = workspace.apps[i];
        const position = layout[i];
        
        // Launch app
        await launchApp(app);
        
        // Position window after a short delay to ensure it's created
        await new Promise(resolve => setTimeout(resolve, 300));
        
        // Set window position and size
        if (window.platform && window.platform.setWindowBounds) {
          try {
            await window.platform.setWindowBounds(app.id, position);
          } catch (error) {
            console.error('Failed to position window:', error);
          }
        }
        
        await new Promise(resolve => setTimeout(resolve, 200));
      }
      
      alert(`‚úÖ Workspace "${workspace.name}" launched with ${appCount} apps!`);
    }
    
    // Calculate smart window layout
    function calculateLayout(appCount) {
      // Get screen dimensions (approximate - will be adjusted by platform)
      const screenWidth = window.screen.availWidth;
      const screenHeight = window.screen.availHeight;
      
      const layouts = [];
      
      if (appCount === 1) {
        // Single app - centered, large
        layouts.push({
          x: Math.floor(screenWidth * 0.1),
          y: Math.floor(screenHeight * 0.1),
          width: Math.floor(screenWidth * 0.8),
          height: Math.floor(screenHeight * 0.8)
        });
      } else if (appCount === 2) {
        // Two apps - side by side
        const width = Math.floor(screenWidth / 2) - 20;
        const height = Math.floor(screenHeight * 0.85);
        
        layouts.push({
          x: 10,
          y: 50,
          width: width,
          height: height
        });
        
        layouts.push({
          x: width + 30,
          y: 50,
          width: width,
          height: height
        });
      } else if (appCount === 3) {
        // Three apps - one large left, two stacked right
        const leftWidth = Math.floor(screenWidth * 0.6);
        const rightWidth = Math.floor(screenWidth * 0.4) - 30;
        const halfHeight = Math.floor(screenHeight * 0.42);
        
        layouts.push({
          x: 10,
          y: 50,
          width: leftWidth,
          height: Math.floor(screenHeight * 0.85)
        });
        
        layouts.push({
          x: leftWidth + 20,
          y: 50,
          width: rightWidth,
          height: halfHeight
        });
        
        layouts.push({
          x: leftWidth + 20,
          y: halfHeight + 60,
          width: rightWidth,
          height: halfHeight
        });
      } else if (appCount === 4) {
        // Four apps - 2x2 grid
        const width = Math.floor(screenWidth / 2) - 20;
        const height = Math.floor(screenHeight / 2) - 40;
        
        layouts.push({ x: 10, y: 50, width, height });
        layouts.push({ x: width + 30, y: 50, width, height });
        layouts.push({ x: 10, y: height + 60, width, height });
        layouts.push({ x: width + 30, y: height + 60, width, height });
      } else {
        // More than 4 - grid layout
        const cols = Math.ceil(Math.sqrt(appCount));
        const rows = Math.ceil(appCount / cols);
        const width = Math.floor(screenWidth / cols) - 20;
        const height = Math.floor(screenHeight / rows) - 40;
        
        for (let i = 0; i < appCount; i++) {
          const col = i % cols;
          const row = Math.floor(i / cols);
          
          layouts.push({
            x: col * (width + 10) + 10,
            y: row * (height + 10) + 50,
            width: width - 10,
            height: height - 10
          });
        }
      }
      
      return layouts;
    }
    
    // Delete workspace
    function deleteWorkspace(index) {
      const workspace = workspaces[index];
      if (confirm(`Delete workspace "${workspace.name}"?`)) {
        workspaces.splice(index, 1);
        saveWorkspaces();
        renderWorkspaces();
      }
    }
    
    // Launch app
    async function launchApp(app) {
      if (runningApps.has(app.id)) {
        await focusApp(app.id);
        return;
      }
      
      try {
        const manifestPath = app.isExternal ? null : app.manifest;
        const manifest = app.isExternal ? app.manifest : null;
        
        if (window.platform) {
          if (app.isExternal) {
            // For external apps, pass manifest directly
            await window.platform.launchAppWithManifest(app.id, manifest);
          } else {
            // For file-based apps, pass manifest path
            await window.platform.launchApp(manifestPath, app.id);
          }
        }
        
        runningApps.set(app.id, app);
        renderApps();
        renderRunningApps();
      } catch (error) {
        console.error('Failed to launch app:', error);
        alert(`Failed to launch ${app.name}: ${error.message}`);
      }
    }
    
    // Close app
    async function closeApp(appId) {
      try {
        if (window.platform) {
          await window.platform.closeApp(appId);
        }
        runningApps.delete(appId);
        renderApps();
        renderRunningApps();
      } catch (error) {
        console.error('Failed to close app:', error);
      }
    }
    
    // Focus app
    async function focusApp(appId) {
      try {
        if (window.platform) {
          await window.platform.focusApp(appId);
        }
      } catch (error) {
        console.error('Failed to focus app:', error);
      }
    }
    
    // Snap window to position
    async function snapWindow(appId, position) {
      const screenWidth = window.screen.availWidth;
      const screenHeight = window.screen.availHeight;
      
      const snapPositions = {
        'left': { x: 0, y: 0, width: screenWidth / 2, height: screenHeight },
        'right': { x: screenWidth / 2, y: 0, width: screenWidth / 2, height: screenHeight },
        'top': { x: 0, y: 0, width: screenWidth, height: screenHeight / 2 },
        'bottom': { x: 0, y: screenHeight / 2, width: screenWidth, height: screenHeight / 2 },
        'top-left': { x: 0, y: 0, width: screenWidth / 2, height: screenHeight / 2 },
        'top-right': { x: screenWidth / 2, y: 0, width: screenWidth / 2, height: screenHeight / 2 },
        'bottom-left': { x: 0, y: screenHeight / 2, width: screenWidth / 2, height: screenHeight / 2 },
        'bottom-right': { x: screenWidth / 2, y: screenHeight / 2, width: screenWidth / 2, height: screenHeight / 2 },
        'center': { x: screenWidth * 0.1, y: screenHeight * 0.1, width: screenWidth * 0.8, height: screenHeight * 0.8 },
        'maximize': { x: 0, y: 0, width: screenWidth, height: screenHeight }
      };
      
      const bounds = snapPositions[position];
      if (bounds && window.platform && window.platform.setWindowBounds) {
        await window.platform.setWindowBounds(appId, bounds);
      }
    }
    
    // Initialize on load
    init();
    
    console.log('Enhanced Platform Launcher Ready!');
    console.log('‚úÖ Add external apps via UI');
    console.log('‚úÖ Create and manage workspaces');
    console.log('‚úÖ Smart window positioning and layouts');
    console.log('‚úÖ OpenFin-compatible manifest format');
  </script>
</body>
</html>
